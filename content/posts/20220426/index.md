---
title: "『RISC-VとChiselで学ぶ はじめてのCPU自作』を読んだ"
date: 2022-04-26T22:44:06+09:00
draft: false
tags: ["Book", "RISC-V", "CPU", "Chisel", "Go"]
slug: "read-first-time-cpu-dev"
---

# はじめに

[『RISC-V と Chisel で学ぶ はじめての CPU 自作』](https://www.amazon.co.jp/dp/4297123053)という本を読んだので感想を残しておこうと思います。

# 本の感想

この本は RISC-V のエミュレータを Chisel という HDL で書くという本です。本の流れとしては、まず CPU の自作に必要なコンピュータ・アーキテクチャや Chisel についての基礎知識から始まり、その後簡単な CPU を実装し、それをもとにしてパイプラインの実装や、ベクトル命令の実装、そしてカスタム命令の実装へと進んでいきます。

僕は、RISC-V どころか CPU すらよくわかっておらず、単純に CPU を作ってみれるなら作ってみたいというような動機で読み始めたものの一応一通り読み切ることができたので、この本のレベル感としてはだいぶ優しいのかなと思います。実際、この本では CPU を自作するために Chisel や Docker,RISC-V 用コンパイラなどのツールが出てきますが、丁寧な説明があるのでこの本通りに自作する分には特に困らないと思います。

個人的に面白かったところは第 1 章と第 2 章です。第 1 章は、論理回路と電子回路のつながりから始まり、どのように論理を組み合わせたら CPU が表現できるのか、そして CPU を構成する電子回路の説明というような流れになっています。第 2 章は、 CPU の構成や処理の流れについての説明です。どちらも基礎的な部分ですが、非常によくまとまっており説明もわかり易く読みやすかったです。この 1,2 章を読むだけでもこの本を買う価値はあると思います。

その後の章で Chisel を用いて CPU を作っていきます。個人的にはこの Chisel というのがなかなかとっつきにくかったです。というのも Chisel は Scala から来ており、オブジェクト指向言語でありかつ HDL なので、どちらの経験もなかった自分としてはコードを理解するのに苦労しました。一応コードに出てくる文法については説明があるので一通り読むことはできました。

Chisel は HDL ですが、この本では実際に FPGA 上で動かすということはせず、あくまで PC 上で動かすエミュレータとして作っています。そこでエミュレータとして作るのであれば、復習とともに別の言語で書き直してみようかなと思いました。

# エミュレータを書き直してみた

最近使っていた Go を使いました。

{{<githubcard url="https://github.com/kinpoko/grvemu" name="grvemu">}}

本の第 2 部までで作成できるものとほとんど同じです。なので[riscv-tests](https://github.com/riscv-software-src/riscv-tests)の一部をパスすることができ、簡単な C のプログラムが動きます。

書き直してみると、本を読んで写経するだけでは考えないようなことまで考えるので、全体的な理解が進みました。

将来的には本の内容にはなかった 64bit や RV32G に対応していきたいです。

# おわりに

非常に良い本だと思いました。説明もわかりやすく本自体もそこまでページ数があるわけではないのでよくまとまっていて、更に CPU にひととおり触れられるので、僕のような CPU 初心者にも読みやすくおすすめだと思います。本の最後に「もっと深く学びたい人のへのお勧め書籍」という項目もあり、次のステップへの道筋も示してくれています。僕は今そこで紹介されている本を読んでいるので、読み終えたらそれもブログにしたいと思います。
